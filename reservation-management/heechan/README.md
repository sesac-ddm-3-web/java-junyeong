# 1. 핵심 요구사항


## 회의실 요구사항

- 애플리케이션이 시작될 때, 미리 정의된 여러 개의 회의실 정보가 인메모리 컬렉션에 저장되어 있어야 합니다.
- **[API]** 전체 회의실 목록을 조회하는 API를 구현해야 합니다.

## 예약 요구사항

- 예약 정보는 특정 회의실 시작 시간, 종료 시간, 예약자 정보(아래 추가 설명)을 포함해야 합니다.
- 비회원 예약제로 진행하여야 합니다. 아래 정보는 필수로 있어야 합니다.
    - 예약자명
    - 전화번호
    - 비밀번호 (예약 수정, 삭제 시 본인 확인용)
- **[API]** 새 예약을 생성하는 API를 구현해야 합니다.
- **[API]** 특정 회의실의 모든 예약 현황을 조회하는 API를 구현해야 합니다.
- **[API]** 특정 예약을 취소(삭제)하는 API를 구현해야 합니다.

## 핵심 비즈니스 로직 및 제약 조건

- 예약 충돌 감지
    - 새 예약을 생성할 때, 요청된 회의실의 요청된 시간대가 기존 다른 예약과 겹치는지 확인해야 합니다.
    - 시간이 겹치는 예약이 이미 존재한다면, 예약을 생성하지 않고 HTTP 상태 코드로 응답해야 합니다.
- 예약 취소 시 비밀번호 검증
    - API 호출 시, 비밀번호를 함께 받아야 합니다.
        - 비밀번호를 받는 방식은 자율적으로 설계하시면 됩니다.
    - 저장된 예약의 비밀번호와 일치하는 경우에만 삭제가 가능합니다.
    - 비밀번호가 틀릴 경우, HTTP status로 응답해야 합니다.
- 유효성 검사
    - 예약 요청 시, 종료 시간은 시작 시간보다 늦어야 합니다.
    - 예약자 정보 등 필수 값은 비어있지 않아야 합니다.
- 예외 처리
    - 존재하지 않는 회의실 ID로 예약하려는 경우
    - 예약 시간이 겹치는 경우
    - 유효성 검사 실패한 경우
    - 등등

---

## 1. 요구사항 분석

- 회의실 정보가 인메모리 컬렉션에 저장되어있다.
  - 회의실 객체는 (회의실 번호, 회의실 이름) 정보를 관리한다.
  

- 예약은 비회원 예약제로 진행된다.
  - 예약자명, 전화번호, 비밀번호, 시간을 예약 정보에 포함해야한다.
  - 예약의 기본 단위는 임의로 30분으로 지정
  - 하루를 표현하는 시간 범위 : 00:00 ~ 24:00 (총 48 slot)
  - 예약 정보에 예약 시간을 관리하면?

    → 필요할 때 데이터를 저장해서, 예약하지 않은 경우 데이터가 생성되지 않는다.
  
    → 가능한 예약 시간인지 검증하는 과정에 startAt, endAt 비교가 필수적이다.

  - 미리 슬롯으로 만들면?

    → 장점 : 시간 비교를 하지 않아도 된다.
  
    → 단점 : 쓰지않는 데이터를 미리 만들게 된다.


- Daily 예약 슬롯 생성 후 해당 Slot 기반 예약 시스템 구현 결정
  - 하루 회의실 기준 생성되는 데이터 48개
  - 365일 기준 약 17만개
  - 회의실 수 100개로 잡고 1년을 계산하면 대략 1700만개의 Slot
  - 10년을 운영한다고 했을 때 데이터 1억개

-> 충분히 감당 가능한 숫자이며, 무엇보다 충돌 검증을 수월하게 진행할 수 있다고 판단.
  

## 2. 객체 파악

- 회의실 (회의실 번호, 회의실 이름)
- 예약 슬롯 (시작 시간, 종료 시간, 오픈 시간, 예약 여부, 회의실)
- 예약 (예약자 명, 비밀번호, 예약 슬롯)

## 3. 도메인 모델

...ing


## 4. API 문서

### 회의실 목록 조회

**GET /meeting-rooms**

응답 본문: MeetingRoomResDto[]
```json
  - id: 회의실 식별자(Long)
  - name: 회의실 이름(String)
```

### 예약 슬롯 목록 조회

**GET /reservation-slots**

응답 본문: ReservationSlotResDto[]
```json
id: 슬롯 식별자(Long)
startAt / endAt: 슬롯 시작·종료 시각(ISO-8601 LocalDateTime)
openedAt: 슬롯이 공개된 시각(ISO-8601 LocalDateTime)
isReserved: 예약 여부(boolean)
meetingRoomId: 연결된 회의실 ID(Long)
```

슬롯 예약 상태 검증 로직: 이미 예약되었거나 공개 시간이 현재 이후인 경우 예약할 수 없으며 409 CONFLICT와 코드 RESERVATION_SLOT_NOT_AVAILABLE가 반환됩니다.

### 예약 생성
**POST /reservations**

요청 본문: ReservationCreateDto
```json
reserverName (String, 필수)
password (String, 필수)
selectedReservationSlotIds (Long[], 1개 이상, 각 원소 필수)
```

성공 시 본문 없이 200 OK(스프링 기본) 응답.

설명:
- 요청한 슬롯 수와 실제 존재하는 슬롯 수가 다르면 400 BAD_REQUEST, 코드 RESERVATION_SLOT_COUNT_MISMATCH 반환.
- 각 슬롯의 예약 가능 여부를 확인한 뒤 예약을 생성합니다.

예외:
- 선택한 슬롯 중 예약 불가 상태가 있으면 409 CONFLICT, 
  코드 RESERVATION_SLOT_NOT_AVAILABLE 반환(상세는 “예약 슬롯 목록 조회” 참고).

예시 요청
```json
{
  "reserverName": "홍길동",
  "password": "secret123",
  "selectedReservationSlotIds": [101, 102]
}
```

### 예약 목록 조회
**GET /reservations**

응답 본문: ReservationResDto[]

```json
reservationId (Long)
reservationName (String)
timeSlot: TImeSlotDto
slotId, startAt, endAt
meetingRoom: MeetingRoomResDto 구조 동일 (위 참고).
```

서비스는 ModelMapper를 이용해 예약과 슬롯, 회의실 정보를 DTO로 변환합니다.

### 예약 삭제
**DELETE /reservations**

요청 본문: ReservationDeleteReqDto

```json
reservationIds (Long[], 1개 이상, 각 원소 필수)
password (String, 필수)
```

성공 시 본문 없이 200 OK.

처리 절차 및 오류:

- 요청 ID 수와 실제 조회된 예약 수가 다르면 400 BAD_REQUEST, 
  코드 RESERVATION_ID_COUNT_MISMATCH.

- 비밀번호가 일치하지 않으면 401 UNAUTHORIZED, 
  코드 INVALID_RESERVATION_PASSWORD.

- 정상 처리 시 각 예약이 점유한 슬롯을 해제합니다.

### 오류 코드 요약
| HTTP 상태 | 코드                                | 발생 조건                                                              |
| ------- | --------------------------------- | ------------------------------------------------------------------ |
| 400     | `VALIDATION_FAILED`               | DTO 유효성 검증 실패 (필수 필드 누락 등)                    |
| 400     | `RESERVATION_ID_COUNT_MISMATCH`   | 삭제 시 요청 ID와 실제 예약 수 불일치     |
| 400     | `RESERVATION_SLOT_COUNT_MISMATCH` | 예약 생성 시 요청 슬롯 ID와 실제 슬롯 수 불일치 |
| 401     | `INVALID_RESERVATION_PASSWORD`    | 예약 삭제 시 비밀번호 불일치           |
| 404     | `NOT_FOUND`                       | 존재하지 않는 회의실 조회(서비스 계층)     |
| 409     | `RESERVATION_SLOT_NOT_AVAILABLE`  | 슬롯이 이미 예약되었거나 아직 열리지 않은 경우  |

---

# 2. 추가 기능 구현

## 1단계 - 회의실 수용 인원 및 예약 인원 제한

### 요구사항

- 회의실 정보에 최대 수용 인원을 추가합니다.
- 예약 요청 시, 참석 인원을 함께 받도록 수정합니다.
- 새 예약 생성 시, 요청된 참석 인원이 해당 회의실의 최대 수용 인원을 초과하는지 검증합니다.
- 초과할 경우, 적절한 HTTP status로 응답합니다.
- **[API] 최소 수용 인원으로 필터링 하는 기능을 추가합니다.**

## 2단계 - 반복 예약 기능 구현

### 요구사항

- 새로운 반복 예약 API를 구현합니다.
- 요청에 기본 예약 정보 외에, 반복 규칙 (e.g., type: WEEKLY, repeatCount: 4 → 4주간 매주 반복)을 포함합니다. (기본 예약 정보에 포함된 유저 정보는 모든 반복 예약에 동일하게 적용됩니다.)
- 반복 규칙에 따라 생성될 모든 예약에 대해 미리 충돌 검사를 수행합니다.
- 4개의 예약 중 단 하나라도 기존 예약과 충돌한다면 HTTP status로 응답하고 아무것도 저장하지 않아야 합니다.
- 모든 반복 예약의 시간이 비어있을 경우에만 모두 저장소에 추가합니다.

## 3단계 - 회의실 비품 동시 예약

- 비품 도메인을 새로 설계합니다. 이 도메인은 전체 재고 수량을 가지고 있어야 합니다.
- 비품 데이터도 애플리케이션 시작 시, 미리 인메모리에 저장합니다.
- 예약 요청에 요청할 비품 목록을 추가합니다.
- 새 예약 생성 시, 회의실 시간이 비어있는지 검사해야 합니다. (기존 요구사항)
- 추가로 요청된 각 비품에 대해, 해당 예약 시간에 이미 예약된 수량을 계산해야 합니다.
- 이미 예약된 수량이 해당 비품의 전체 재고 수량을 초과하는지 검사합니다.
- 이회의실 시간이 비어있더라도, 요청한 비품 중 단 하나라도 재고가 부족하면 HTTP status로 응답하고 전체 예약을 실패 시켜야 합니다.